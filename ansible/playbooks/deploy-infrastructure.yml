---
- name: Deploy Complete Azure Infrastructure
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    project_name: angular-automated-app
    location: eastus
    resource_group: "{{ project_name }}-rg"
    acr_name: "{{ project_name | replace('-', '') }}acr"
    app_service_plan: "{{ project_name }}-plan"
    web_app_name: "{{ project_name }}"
  
  tasks:
    - name: Create Resource Group
      shell: |
        az group create --name {{ resource_group }} --location {{ location }}

    - name: Register Azure Providers
      shell: |
        az provider register --namespace Microsoft.ContainerRegistry
        az provider register --namespace Microsoft.Web
        az provider register --namespace Microsoft.Storage
        az provider register --namespace Microsoft.ContainerInstance

    - name: Create Container Registry
      shell: |
        az acr create --resource-group {{ resource_group }} --name {{ acr_name }} --sku Basic --admin-enabled true

    - name: Create Container Instance
      shell: |
        az container create --resource-group {{ resource_group }} --name {{ web_app_name }} --image nginx:alpine --dns-name-label {{ web_app_name }} --ports 80 --os-type Linux --cpu 1 --memory 1

    - name: Display Infrastructure Info
      debug:
        msg:
          - "âœ… Infrastructure Created Successfully!"
          - "Resource Group: {{ resource_group }}"
          - "Container Registry: {{ acr_name }}.azurecr.io"
          - "Container URL: http://{{ web_app_name }}.{{ location }}.azurecontainer.io"