---
- name: Build and Deploy Angular Application
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    project_name: angular-automated-app
    resource_group: "{{ project_name }}-rg"
    acr_name: "{{ project_name | replace('-', '') }}acr"
    web_app_name: "{{ project_name }}"
    docker_image: "{{ acr_name }}.azurecr.io/{{ project_name }}:latest"
  
  tasks:
    - name: Build Docker Image
      shell: |
        docker build -t {{ docker_image }} ../..

    - name: Login to ACR
      shell: |
        az acr login --name {{ acr_name }}

    - name: Push Image to ACR
      shell: |
        docker push {{ docker_image }}

    - name: Update Web App Container
      shell: |
        az webapp config container set --name {{ web_app_name }} --resource-group {{ resource_group }} --docker-custom-image-name {{ docker_image }}

    - name: Start Web App
      shell: |
        az webapp start --name {{ web_app_name }} --resource-group {{ resource_group }}

    - name: Display Deployment Info
      debug:
        msg:
          - "ðŸš€ Application Deployed Successfully!"
          - "Web App URL: https://{{ web_app_name }}.azurewebsites.net"
          - "Docker Image: {{ docker_image }}"